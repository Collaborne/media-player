"use strict";(self.webpackChunk_collaborne_media_player=self.webpackChunk_collaborne_media_player||[]).push([[589],{"./.storybook/stories/11-KaraokeMode.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{KaraokeMode:()=>KaraokeMode,__namedExportsOrder:()=>__namedExportsOrder,default:()=>_11_KaraokeMode_stories});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),useToggle=__webpack_require__("./node_modules/react-use/esm/useToggle.js"),usePreviousDistinct=__webpack_require__("./node_modules/react-use/esm/usePreviousDistinct.js"),src=__webpack_require__("./src/index.ts"),utils=__webpack_require__("./src/utils/index.ts"),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),styled=__webpack_require__("./node_modules/@mui/material/styles/styled.js"),IGNORE_PROPS=["isActive"],TimestampStyled=(0,styled.ZP)("button",{shouldForwardProp:function shouldForwardProp(props){return!IGNORE_PROPS.includes(props)}})((function(_ref){var theme=_ref.theme,_ref$isActive=_ref.isActive;return{background:void 0!==_ref$isActive&&_ref$isActive?theme.palette.primary.main:"transparent",outline:0,border:0,marginRight:theme.spacing(.25),padding:theme.spacing(.5),cursor:"pointer"}})),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),Timestamp=react.forwardRef((function(props,ref){return(0,jsx_runtime.jsx)(TimestampStyled,(0,objectSpread2.Z)({ref},props))}));Timestamp.__docgenInfo={description:"",methods:[],displayName:"Timestamp",props:{isActive:{required:!0,tsType:{name:"boolean"},description:""}},composes:["ButtonProps"]};var number=__webpack_require__("./src/utils/number.ts"),decorators=__webpack_require__("./.storybook/decorators/index.ts"),with_player_theme=__webpack_require__("./.storybook/decorators/with-player-theme.tsx"),FIND_PART_STRATEGY=function(FIND_PART_STRATEGY){return FIND_PART_STRATEGY.NEXT="NEXT",FIND_PART_STRATEGY.PREV="PREV",FIND_PART_STRATEGY.CLOSEST="CLOSEST",FIND_PART_STRATEGY}(FIND_PART_STRATEGY||{});function getMatchingPartToTimestamp(transcript,timestamp){for(var strategy=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FIND_PART_STRATEGY.CLOSEST,start=0,end=transcript.length-1,part={start:0,index:0,end:0},mid=0;start<=end&&!(timestamp>=(part=transcript[mid=Math.floor((start+end)/2)]).start&&timestamp<part.end);)part.start<timestamp?start=mid+1:end=mid-1;if(timestamp>=part.start&&timestamp<part.end)return part;if(strategy===FIND_PART_STRATEGY.CLOSEST){if(timestamp>part.end){var currentDiff=Math.abs(timestamp-part.end),nextPart=transcript[mid+1];return nextPart?currentDiff<Math.abs(timestamp-(null==nextPart?void 0:nextPart.start))?part:nextPart:part}if(timestamp<part.start){var _currentDiff=Math.abs(timestamp-part.start),prevPart=transcript[mid-1];return prevPart?_currentDiff<Math.abs(timestamp-(null==prevPart?void 0:prevPart.end))?part:prevPart:part}return part}if(strategy===FIND_PART_STRATEGY.PREV){var _prevPart=transcript[mid-1];return timestamp>=part.end?part:null!=_prevPart?_prevPart:part}if(strategy===FIND_PART_STRATEGY.NEXT){var _nextPart=transcript[mid+1];return timestamp<=part.start?part:null!=_nextPart?_nextPart:part}return part}var findMatchingPartOrNext=function findMatchingPartOrNext(transcript,timestamp){return getMatchingPartToTimestamp(transcript,timestamp,FIND_PART_STRATEGY.NEXT)},KaraokeMode=function KaraokeMode(args){var _useToggle=(0,useToggle.Z)(!1),_useToggle2=(0,slicedToArray.Z)(_useToggle,2),isTimestampToggle=_useToggle2[0],toggleReadyTimestapms=_useToggle2[1],_React$useState=react.useState(!1),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),isPlayerReady=_React$useState2[0],setIsPlayerReady=_React$useState2[1],transcriptsElementRef=react.useRef([]),alarmRef=react.useRef([]),setTranscriptsElementRef=function setTranscriptsElementRef(ref){return transcriptsElementRef.current.push({ref})},_usePlayerContext=(0,src.gDo)(),setMediaContext=_usePlayerContext.setMediaContext,mediaContext=_usePlayerContext.mediaContext,mediaDuration=(null==mediaContext?void 0:mediaContext.duration)||0,transcriptRef=react.useRef([]),listener=null==mediaContext?void 0:mediaContext.getListener(),setCurrentTime=null==mediaContext?void 0:mediaContext.setCurrentTime,_useDelayedState=(0,src.FDY)({index:0,end:0,start:0}),_useDelayedState2=(0,slicedToArray.Z)(_useDelayedState,2),currentPart=_useDelayedState2[0],setCurrentPart=_useDelayedState2[1],getCurrentTimePart=react.useCallback((function(){var _mediaContext$reactPl,_mediaContext$reactPl2,mediaEl=null==mediaContext||null===(_mediaContext$reactPl=mediaContext.reactPlayerRef)||void 0===_mediaContext$reactPl||null===(_mediaContext$reactPl2=_mediaContext$reactPl.current)||void 0===_mediaContext$reactPl2?void 0:_mediaContext$reactPl2.getInternalPlayer();if(mediaEl)return findMatchingPartOrNext(transcriptRef.current,1e3*mediaEl.currentTime-1)}),[mediaContext]),onSeek=react.useCallback((function(){var curPart=getCurrentTimePart();curPart&&setCurrentPart(curPart,1)}),[getCurrentTimePart,setCurrentPart]);(0,src.IcN)("seeked",onSeek,listener),(0,src.IcN)("ready",(function(){return setIsPlayerReady(!0)}),listener),(0,src.IcN)("onTimeAlarm",(function(e){var res=findMatchingPartOrNext(transcriptRef.current,e.seconds);setCurrentPart(res,1)}),listener);var createAlarms=react.useCallback((function(){for(var sec=0;sec<mediaDuration;sec++)for(var secMultiplier=0;secMultiplier<args.secondsDivider;secMultiplier++){var secondDigits=0===secMultiplier?0:1/args.secondsDivider*secMultiplier;alarmRef.current.push((0,utils.mu)(sec+secondDigits))}}),[mediaDuration,args.secondsDivider]);react.useEffect((function(){transcriptRef.current=function createTimestamps(stopPointSeconds,secondDivider){for(var result=[],i=0;i<stopPointSeconds*secondDivider;i++)result.push({start:(0,number.m)(i/secondDivider),end:(0,number.m)((i+1)/secondDivider),index:i});return result}(mediaDuration,args.secondsDivider),toggleReadyTimestapms(),createAlarms()}),[mediaDuration,args.secondsDivider,isPlayerReady]);var timeStampsMemo=react.useMemo((function(){return isPlayerReady&&transcriptRef.current.length>0?transcriptRef.current.map((function(_ref){var start=_ref.start,end=_ref.end,index=_ref.index;return(0,jsx_runtime.jsx)(Timestamp,{ref:setTranscriptsElementRef,onClick:function onClick(){return null==setCurrentTime?void 0:setCurrentTime(start)},isActive:!1,children:"[".concat(start," - ").concat(end,"]")},index)})):null}),[isPlayerReady,isTimestampToggle]),prevCurrent=(0,usePreviousDistinct.Z)(currentPart),createActiveSpan=(0,react.useCallback)((function(){var element=transcriptsElementRef.current[currentPart.index];if(element&&element.ref&&(element.ref.style.background="red"),prevCurrent){var _element=transcriptsElementRef.current[prevCurrent.index];_element&&_element.ref&&(_element.ref.style.background="")}return null}),[currentPart,timeStampsMemo]);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.Syo,{url:args.url,onStoreUpdate:setMediaContext,alarms:alarmRef.current,isPipEnabled:args.isPipEnabled}),(0,jsx_runtime.jsx)("div",{children:timeStampsMemo}),createActiveSpan()]})};const _11_KaraokeMode_stories={title:"Karaoke Mode",component:KaraokeMode,decorators:[decorators.ij,with_player_theme.l],args:{url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",secondsDivider:2,isPipEnabled:!0},argTypes:{url:{name:"url",description:"A media URL. Only file type supported",table:{type:{summary:"string"},defaultValue:{summary:void 0}}},secondsDivider:{name:"secondsDivider",description:"Split 1 second into intervals.",table:{type:{summary:"number"},defaultValue:{summary:2}}},isPipEnabled:{name:"props.isPipEnabled",description:"Enables/disables all pip features(scrolling, entering/leaving PIP mode)",table:{type:{summary:"boolean"},defaultValue:{summary:!0}}}}},__namedExportsOrder=["KaraokeMode"]},"./src/components/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w3:()=>BottomControls.w,ae:()=>types.a,lD:()=>CorePlayer.l,vN:()=>EventBasedProgressBar,pU:()=>components.pU,Sy:()=>MediaPlayer.S,PF:()=>MediaPoster.P,DF:()=>components.DF,Vj:()=>components.Vj,ko:()=>ProgressBar.k,LU:()=>components.LU,QG:()=>components.QG});__webpack_require__("./src/components/animated-icon-wrapper/AnimatedIconWrapper.tsx"),__webpack_require__("./src/components/big-centered-button/BigCenteredButton.tsx"),__webpack_require__("./src/components/bottom-control-buttons/BottomControlButtons.tsx");var components=__webpack_require__("./src/components/bottom-control-buttons/components/index.ts"),BottomControls=__webpack_require__("./src/components/bottom-controls/BottomControls.tsx"),CorePlayer=(__webpack_require__("./src/components/centered-play-button/CenteredPlayButton.tsx"),__webpack_require__("./src/components/centered-replay-button/CenteredReplayButton.tsx"),__webpack_require__("./src/components/controls/Controls.tsx"),__webpack_require__("./src/components/core-player/CorePlayer.tsx")),types=__webpack_require__("./src/components/core-player/types.ts"),ProgressBar=(__webpack_require__("./src/components/draggable-popover/DraggablePopover.tsx"),__webpack_require__("./src/components/frame/index.ts"),__webpack_require__("./src/components/pip-controls/PipControls.tsx"),__webpack_require__("./src/components/pip-controls/usePipControlsHook.ts"),__webpack_require__("./src/components/play-pause-animation/PauseAnimation.tsx"),__webpack_require__("./src/components/play-pause-animation/PlayAnimation.tsx"),__webpack_require__("./src/components/progress-bar/ProgressBar.tsx")),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),react=__webpack_require__("./node_modules/react/index.js"),EventRailsProvider=__webpack_require__("./src/context/EventRailsProvider.tsx"),hooks=__webpack_require__("./src/hooks/index.ts"),utils=__webpack_require__("./src/utils/index.ts"),constants=__webpack_require__("./src/utils/constants.ts"),use_event_rails_context=__webpack_require__("./src/hooks/use-event-rails-context.ts"),utils_highlights=__webpack_require__("./src/utils/highlights.ts"),RailStyled=__webpack_require__("./src/components/progress-bar/components/RailStyled.ts"),useRailStyles=__webpack_require__("./src/components/progress-bar/components/useRailStyles.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),BLEND_CONFIG={intensifyAll:!0},EventRail=function EventRail(){var _useEventRailsContext=(0,use_event_rails_context.n)(),duration=_useEventRailsContext.duration,getHighlightColorBlended=_useEventRailsContext.getHighlightColorBlended,highlights=_useEventRailsContext.highlights,sliderRail=(0,useRailStyles.c)().classes.sliderRail;return(0,jsx_runtime.jsx)("div",{className:sliderRail,children:null==highlights?void 0:highlights.map((function(_ref){var id=_ref.id,colors=_ref.colors,start=_ref.start,end=_ref.end,highlightEdgesColor=null==getHighlightColorBlended?void 0:getHighlightColorBlended(colors,BLEND_CONFIG);return(0,jsx_runtime.jsx)(RailStyled.J,{startPoint:(0,utils_highlights.O)(start,duration),width:(0,utils_highlights.O)(end-start,duration),color:null==getHighlightColorBlended?void 0:getHighlightColorBlended(colors),startColorSegment:highlightEdgesColor,endColorSegment:highlightEdgesColor},id)}))})};EventRail.__docgenInfo={description:"",methods:[],displayName:"EventRail"};var ProgressBarStyled=__webpack_require__("./src/components/progress-bar/components/ProgressBarStyled.ts"),_excluded=["mediaListener","highlights","getHighlightColorBlended","setCurrentTime"],EventBasedProgressBar=function EventBasedProgressBar(_ref){var mediaListener=_ref.mediaListener,_ref$highlights=_ref.highlights,highlights=void 0===_ref$highlights?[]:_ref$highlights,_ref$getHighlightColo=_ref.getHighlightColorBlended,getHighlightColorBlended=void 0===_ref$getHighlightColo?utils.NH:_ref$getHighlightColo,setCurrentTime=_ref.setCurrentTime,props=(0,objectWithoutProperties.Z)(_ref,_excluded),_useState=(0,react.useState)(0),_useState2=(0,slicedToArray.Z)(_useState,2),value=_useState2[0],setValue=_useState2[1],_useState3=(0,react.useState)(0),_useState4=(0,slicedToArray.Z)(_useState3,2),duration=_useState4[0],setDuration=_useState4[1];return(0,hooks.Ic)("durationchange",(function(e){return setDuration(e.duration)}),mediaListener),(0,hooks.Ic)("timeupdate",(function(_ref2){var duration=_ref2.duration,seconds=_ref2.seconds;return setValue(duration&&seconds?(0,utils.mu)(seconds/duration*constants.JV):0)}),mediaListener),(0,jsx_runtime.jsx)(EventRailsProvider.$,{highlights,duration,getHighlightColorBlended,children:(0,jsx_runtime.jsx)(ProgressBarStyled.D,(0,objectSpread2.Z)({min:0,max:constants.JV,onChange:function onCurrentTimeUpdate(e,newValue,_activeThumb){if(e.preventDefault(),!Array.isArray(newValue)){var seekTime=newValue/constants.JV*duration;null==setCurrentTime||setCurrentTime(seekTime)}},value,components:{Rail:EventRail}},props))})};EventBasedProgressBar.__docgenInfo={description:"A MUI Slider configured for displaying currentTime/duration values from `MediaStore`\nuses `EmitterListeners` for displaying data\n@category React Component\n@category UI Controls",methods:[],displayName:"EventBasedProgressBar",props:{mediaListener:{required:!1,tsType:{name:"EmitterListeners"},description:""},setCurrentTime:{required:!1,tsType:{name:"signature",type:"function",raw:"(relativeSeconds: number) => void",signature:{arguments:[{type:{name:"number"},name:"relativeSeconds"}],return:{name:"void"}}},description:""},highlights:{required:!1,tsType:{name:"Array",elements:[{name:"Highlight"}],raw:"Highlight[]"},description:"",defaultValue:{value:"[]",computed:!1}},getHighlightColorBlended:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n\tcolors: string[],\n\tparams?: BlendConfig,\n) => string | undefined",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"colors"},{type:{name:"BlendConfig"},name:"params"}],return:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}}},description:"",defaultValue:{value:"(\n\tcolors,\n\t{ intensifyIndex, intensifyAll, discountFactor = 1 } = {},\n) => {\n\tif (colors.length === 0) {\n\t\treturn undefined;\n\t}\n\n\tconst [initial, ...rest] = colors.map(hexToRGB).map((rgb, index) => {\n\t\t// Make the intensified color more prevalent that the other colors.\n\t\tconst alpha =\n\t\t\tintensifyAll || intensifyIndex === index\n\t\t\t\t? INTENSIFIED_ALPHA\n\t\t\t\t: BLEND_ALPHA;\n\t\treturn rgbToRgba(rgb, alpha * discountFactor);\n\t});\n\n\tconst mixed = rest.reduce((background, foreground) => {\n\t\treturn multiply(background, foreground);\n\t}, initial);\n\n\treturn rgbaToHexA(mixed);\n}",computed:!1}}},composes:["SliderProps"]};__webpack_require__("./src/components/media-container/MediaContainer.tsx");var MediaPlayer=__webpack_require__("./src/components/media-player/MediaPlayer.tsx"),MediaPoster=__webpack_require__("./src/components/media-poster/MediaPoster.tsx")},"./src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{FDY:()=>_hooks__WEBPACK_IMPORTED_MODULE_2__.FD,IcN:()=>_hooks__WEBPACK_IMPORTED_MODULE_2__.Ic,LUJ:()=>_components__WEBPACK_IMPORTED_MODULE_0__.LU,PFg:()=>_components__WEBPACK_IMPORTED_MODULE_0__.PF,QGR:()=>_components__WEBPACK_IMPORTED_MODULE_0__.QG,Syo:()=>_components__WEBPACK_IMPORTED_MODULE_0__.Sy,VjV:()=>_components__WEBPACK_IMPORTED_MODULE_0__.Vj,gDo:()=>_hooks__WEBPACK_IMPORTED_MODULE_2__.gD,lDp:()=>_components__WEBPACK_IMPORTED_MODULE_0__.lD,pUZ:()=>_components__WEBPACK_IMPORTED_MODULE_0__.pU,vNc:()=>_components__WEBPACK_IMPORTED_MODULE_0__.vN});var _components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/index.ts"),_hooks__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./src/context/index.ts"),__webpack_require__("./src/hooks/index.ts"));__webpack_require__("./src/store/media-store.ts"),__webpack_require__("./src/utils/index.ts")}}]);